'use strict';

var path = require('path');
var _ = require('lodash');
var config = require('../config');
var util = require('../utils/util');

module.exports = remapSources;

function remapSources(file) {
  var parsedMap = _.isString(file.map) ? JSON.parse(file.map) : file.map;
  parsedMap.sources = _.map(parsedMap.sources, function (source) {
    var strippedPath = util.stripIgnoredBasePath(source, config.assetIgnoredBasePaths);
    return path.join('/sourcemaps/', strippedPath);
  });
  var map = JSON.stringify(_.pick(parsedMap, 'version', 'mappings', 'names', 'sources'));
  return _.assign(file, { map: map });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wbHVnaW5zL3JlbWFwLXNvdXJjZXMuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJfIiwiY29uZmlnIiwidXRpbCIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZW1hcFNvdXJjZXMiLCJmaWxlIiwicGFyc2VkTWFwIiwiaXNTdHJpbmciLCJtYXAiLCJKU09OIiwicGFyc2UiLCJzb3VyY2VzIiwic3RyaXBwZWRQYXRoIiwic3RyaXBJZ25vcmVkQmFzZVBhdGgiLCJzb3VyY2UiLCJhc3NldElnbm9yZWRCYXNlUGF0aHMiLCJqb2luIiwic3RyaW5naWZ5IiwicGljayIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxPQUFPQyxRQUFRLE1BQVIsQ0FBYjtBQUNBLElBQU1DLElBQUlELFFBQVEsUUFBUixDQUFWO0FBQ0EsSUFBTUUsU0FBU0YsUUFBUSxXQUFSLENBQWY7QUFDQSxJQUFNRyxPQUFPSCxRQUFRLGVBQVIsQ0FBYjs7QUFFQUksT0FBT0MsT0FBUCxHQUFpQkMsWUFBakI7O0FBRUEsU0FBU0EsWUFBVCxDQUFzQkMsSUFBdEIsRUFBNEI7QUFDMUIsTUFBTUMsWUFBWVAsRUFBRVEsUUFBRixDQUFXRixLQUFLRyxHQUFoQixJQUF1QkMsS0FBS0MsS0FBTCxDQUFXTCxLQUFLRyxHQUFoQixDQUF2QixHQUE4Q0gsS0FBS0csR0FBckU7QUFDQUYsWUFBVUssT0FBVixHQUFvQlosRUFBRVMsR0FBRixDQUFNRixVQUFVSyxPQUFoQixFQUF5QixrQkFBVTtBQUNyRCxRQUFNQyxlQUFlWCxLQUFLWSxvQkFBTCxDQUEwQkMsTUFBMUIsRUFBa0NkLE9BQU9lLHFCQUF6QyxDQUFyQjtBQUNBLFdBQU9sQixLQUFLbUIsSUFBTCxDQUFVLGNBQVYsRUFBMEJKLFlBQTFCLENBQVA7QUFDRCxHQUhtQixDQUFwQjtBQUlBLE1BQU1KLE1BQU1DLEtBQUtRLFNBQUwsQ0FBZWxCLEVBQUVtQixJQUFGLENBQU9aLFNBQVAsRUFBa0IsU0FBbEIsRUFBNkIsVUFBN0IsRUFBeUMsT0FBekMsRUFBa0QsU0FBbEQsQ0FBZixDQUFaO0FBQ0EsU0FBT1AsRUFBRW9CLE1BQUYsQ0FBU2QsSUFBVCxFQUFlLEVBQUNHLFFBQUQsRUFBZixDQUFQO0FBQ0QiLCJmaWxlIjoicmVtYXAtc291cmNlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5jb25zdCBjb25maWcgPSByZXF1aXJlKCcuLi9jb25maWcnKTtcbmNvbnN0IHV0aWwgPSByZXF1aXJlKCcuLi91dGlscy91dGlsJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gcmVtYXBTb3VyY2VzO1xuXG5mdW5jdGlvbiByZW1hcFNvdXJjZXMoZmlsZSkge1xuICBjb25zdCBwYXJzZWRNYXAgPSBfLmlzU3RyaW5nKGZpbGUubWFwKSA/IEpTT04ucGFyc2UoZmlsZS5tYXApIDogZmlsZS5tYXA7XG4gIHBhcnNlZE1hcC5zb3VyY2VzID0gXy5tYXAocGFyc2VkTWFwLnNvdXJjZXMsIHNvdXJjZSA9PiB7XG4gICAgY29uc3Qgc3RyaXBwZWRQYXRoID0gdXRpbC5zdHJpcElnbm9yZWRCYXNlUGF0aChzb3VyY2UsIGNvbmZpZy5hc3NldElnbm9yZWRCYXNlUGF0aHMpO1xuICAgIHJldHVybiBwYXRoLmpvaW4oJy9zb3VyY2VtYXBzLycsIHN0cmlwcGVkUGF0aCk7XG4gIH0pO1xuICBjb25zdCBtYXAgPSBKU09OLnN0cmluZ2lmeShfLnBpY2socGFyc2VkTWFwLCAndmVyc2lvbicsICdtYXBwaW5ncycsICduYW1lcycsICdzb3VyY2VzJykpO1xuICByZXR1cm4gXy5hc3NpZ24oZmlsZSwge21hcH0pO1xufVxuIl19